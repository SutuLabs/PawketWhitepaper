<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Pawket Security White Paper</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="Cover.html"><strong aria-hidden="true">1.</strong> Cover</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="Introduction.html"><strong aria-hidden="true">2.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="Architecture.html"><strong aria-hidden="true">3.</strong> Application Architecture</a></li><li class="chapter-item expanded affix "><li class="part-title">Blockchain Specific Design</li><li class="chapter-item expanded "><a href="chia/index.html"><strong aria-hidden="true">4.</strong> Chia</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chia/mnemonic.html"><strong aria-hidden="true">4.1.</strong> Mnemonic</a></li><li class="chapter-item expanded "><a href="chia/encryption.html"><strong aria-hidden="true">4.2.</strong> Encryption</a></li><li class="chapter-item expanded "><a href="chia/multisig.html"><strong aria-hidden="true">4.3.</strong> MultiSig</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Security</li><li class="chapter-item expanded "><a href="Principles.html"><strong aria-hidden="true">5.</strong> General Security Principles</a></li><li class="chapter-item expanded "><a href="Mitigation.html"><strong aria-hidden="true">6.</strong> Risk Mitigation Strategies</a></li><li class="chapter-item expanded "><a href="Attack.html"><strong aria-hidden="true">7.</strong> Impact on Potential Attack Scenarios</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="About.html"><strong aria-hidden="true">8.</strong> About Us</a></li><li class="chapter-item expanded "><a href="BackCover.html"><strong aria-hidden="true">9.</strong> Back Cover</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Pawket Security White Paper</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p align="right">
  <a href="https://info.pawket.app"><img src="https://info.pawket.app/images/site-navigation/logo.svg" alt="pawket" width="120" /></a>
</p>
<section style="margin-top: 40vh; margin-left: 10vw;">
    <h1 style="font-size: 2em;">Security White Paper</h1>
    <h2 style="margin-top: -0.8em; font-weight: normal; color: #888">Draft v0.1</h2>
    <p style="margin-top: 4em;">October 2022</p>
</section><div style="break-before: page; page-break-before: always;"></div><h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Pawket: A secure handy wallet, developing in the agile process.</p>
<p>When the Pawket team embarked on the ambitious journey of creating the best possible blockchain wallet designed for Chia, we started by defining a few design principles. Here are some of the guiding principles that helped us shape Pawket in its current form:</p>
<ul>
<li><strong>No mandatory internet access</strong>.
It should not include any scripts hosted on a third-party domain or require you to create a user account on the server. While some functionalities such as retrieving balances, starting transactions, and third-party integrations will always depend on internet access, the main function of signing transactions must remain usable in a closed network with no internet access.</li>
<li><strong>No secret key derivatives server-side</strong>.
Even an encrypted or derived version of the user mnemonics or private key should never be sent or stored server side.</li>
<li><strong>Interoperable cryptography</strong>.
A user must be able to take away any account with the tools of their choice, not just the one provided by us.</li>
<li><strong>Free and open source software</strong>.
Both the client and the server should be fully available in an open source license. The software stack required to run the server should also be open source. The software should not include any mandatory proprietary component of any kind.</li>
<li><strong>Privacy by design. No tracking</strong>.
The software should not store unnecessary personal information. The software should not report back user behavior or analytics to any third-party website unless the administrator or the user explicitly opt-in.</li>
<li><strong>Security by default</strong>.
The solution should propose sane security settings by default. A power user can however still adjust the settings to match their security requirements and risk appetite.</li>
</ul>
<p>If these principles are also important to you, there are good chances that Pawket will be the right fit. The rest of the document will provide you with information about the implementation details and associated risks so that you can make that call.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="application-architecture"><a class="header" href="#application-architecture">Application Architecture</a></h1>
<p>Some knowledge about the different layers of the application is needed to better understand the attack surface. This section briefly explains the overall software architecture of Pawket.</p>
<h2 id="server"><a class="header" href="#server">Server</a></h2>
<p><img src="server_arch.drawio.svg" alt="" /></p>
<p>Pawket clients connect to the Light server by default, which provides a quick response without needing to synchronize the whole/selective blockchain.</p>
<p>The Light Server and the Syncer are developed in .Net 6.0, following the standard API design pattern. This server application relies on a Postgresql database, which cache and calculates the balance for clients.</p>
<p>Pawket clients are also allowed to connect to Full Node RPC, which could permit the client to connect to their trust Node to avoid API attacks. However, it could lose the benefit of the ability to get the balance quickly. </p>
<p>With Pawket Light Server, even dusted accounts can get balance instantly, thanks to Analytic DB in the backend, which is storing the analytic result of on-chain data by Syncer.</p>
<p>The data stored in Analytic DB is like this:
(almost the same to the Chia SQLite DB)</p>
<pre class="mermaid">erDiagram
    sync_coin_record {
        bigint id PK
        bytea coin_name
        bigint confirmed_index
        bigint spent_index
        bool coinbase
        bytea puzzle_hash
        bytea coin_parent
        bigint amount
        bigint timestamp
    }
    sync_hint_record {
        bigint id PK
        bytea coin_name
        bytea hint
    }
    sync_coin_record }o--o{ sync_hint_record : coin_name
    sync_coin_record }o--|{ sync_coin_record : coin_parent
</pre>
<h2 id="web-client"><a class="header" href="#web-client">Web Client</a></h2>
<p><img src="client_arch.drawio.svg" alt="" /></p>
<p>All data are stored in localStorage, and the sensitive information is encrypted with the User Master Password.</p>
<p>The web client also accepts API calls.</p>
<h2 id="cli"><a class="header" href="#cli">CLI</a></h2>
<p>The <code>Coin Manipulator</code> can be reused to support CLI manipulation.</p>
<p>As Web Client is written in Typescript (a dialect of Javascript), it can be easily migrated to run in CLI with nodejs.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="chia"><a class="header" href="#chia">Chia</a></h1>
<p>Pawket is initially designed to serving Chia Network, however, the internal design is aim to be an universal blockchain account manager.
We will describe chain specific design in this section.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mnemonic"><a class="header" href="#mnemonic">Mnemonic</a></h1>
<p>Pawket's master mnemonic is not compactible with Chia Official Wallet, even we simply allow the length of mnemonic to be 24 words,
because they are indeed different generation process.</p>
<p>For Chia Official Wallet, looks like this:</p>
<pre class="mermaid">graph LR;

    A(&quot;Mnemonic&lt;br/&gt;(24 words)&quot;)--&gt;B[PBKDF2]--&gt;C(Chia Private Key)
</pre>
<p>Indeed, Chia Official Wallet accept any type of text as input other than standard word defined in BIP39, because the whole process is just lots of HASH calculations.</p>
<p>For Pawket, looks like this:</p>
<pre class="mermaid">graph LR;

    A(&quot;Mnemonic&lt;br&gt;(12 words)&quot;)--&gt;D[BIP39&lt;br/&gt;Mnemonic to seed];
    D--&gt;E[&quot;BIP39&lt;br/&gt;Entropy to mnemonic&lt;br/&gt;(24 words)&lt;br/&gt;[Chia Compatible Mnemonic]&quot;];
    E--&gt;B[PBKDF2]--&gt;C(Chia Private Key);
    classDef pawket fill:#39C0AE,stroke:#FFFFAE;
    class D,E pawket;
</pre>
<p>Pawket strictly comply with <a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki">BIP39</a> to gain better compatibility.</p>
<p><strong>Design Consideration</strong>:</p>
<ul>
<li>Pawket designs to be chain-agnostic, so universal compatibility is important.</li>
<li>Comply with BIP39, Pawket implements <strong>Shadow Wallet</strong> with greatest possible compatibility.</li>
<li>Comply with BIP39, Pawket supports non-english mnemonic words naively.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="encryption"><a class="header" href="#encryption">Encryption</a></h1>
<p>Pawket utilized the Chia's BLS curve(BLS12-381) and ECDH mechanism to create encryption algorithm, allow user to encrypt message with recipient's address, which only the recipient have ability to decrypt the message, just like the asymmetric encryption did.</p>
<p>With this mechanism, created a good user experience to send message to arbitrary activated address without communication or setup beforehand.</p>
<p>Here are notions:</p>
<ul>
<li><strong>Synthetic Key</strong>: which is unique for each address in your wallet, it represents a synthetic child key of your root key. </li>
<li><strong>Synthetic Public Key</strong>: <code>spk</code>, the public part of synthetic key, can be calculate from synthetic private key and it is on-chain for every standard xch transaction.</li>
<li><strong>Synthetic Private Key</strong>: <code>ssk</code>, the private part of synthetic key, only the private key owner can calculate this key, can be used to decrypt message encrypted by synthetic public key.</li>
<li><strong>Activated Address</strong>: address with at least one coin is spent, that is one coin is sent from this address, and the <code>spk</code> was recorded on-chain.</li>
</ul>
<p>Following is the procedure during encryption and decryption.</p>
<pre class="mermaid">sequenceDiagram
    participant C as Chia Blockchain
    participant A as Alice
    participant B as Bob
    C -&gt;&gt; A: ❶ spk_B
    A-&gt;&gt;A: ❷ shared = ssk_A * spk_B
    A-&gt;&gt;B: ❸ spk_A, encrypted = enc(plain, shared)
    B-&gt;&gt;B: ❺ shared = ssk_B * spk_A,&lt;br/&gt; plain = dec(encrypted, shared)
</pre>
<ul>
<li>❶ Get Bob's <code>spk</code> from Blockchain, which requires activated address.</li>
<li>❷ Calculate the shared key according to ECDH.</li>
<li>❸ Send the encrypted message and Alice's <code>spk</code>.</li>
<li>❹ Calculate the shared key by Bob's <code>ssk</code> and Alice's <code>spk</code> according to ECDH, then decrypted the message.</li>
</ul>
<p><strong>Demonstration</strong></p>
<p>Following is a demo of composite encrypted message:</p>
<pre><code class="language-text">-------- pawket.xch ---------
Sender Address: xch1ahu8zdwg03qadmk4tan653hxdjy596k6dy63wm0r6etj0g0y5uws4jwntt
Receiver Address: xch16xwqtf2d4jljks8lfpp4xnz8jak7jqjxc07y9tqlgt4grdp5hr4q7vcx3s
Encrypted Message: fd8ccb693c60e1ba3281c0d1a66c8539a537de6365ca685545052842626a5a1c
</code></pre>
<ul>
<li><strong>Sender Address</strong>: from this address, program can find the <code>spk_A</code> from blockchain.</li>
<li><strong>Receiver Address</strong>: from this address, program can find the <code>ssk_B</code> from wallet.</li>
<li><strong>Encrypted Message</strong>: with shared key calculated by ECDH, the message can be decrypted.</li>
</ul>
<p><strong>Note</strong>: you can also refer to the <a href="https://github.com/SutuLabs/Pawket/blob/master/packages/pawket-chia-lib/services/crypto/ecdh.ts">source code</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multisig-mpc-wallet"><a class="header" href="#multisig-mpc-wallet">MultiSig (MPC) Wallet</a></h1>
<h2 id="our-solution-bls-aggregation"><a class="header" href="#our-solution-bls-aggregation">Our Solution: BLS Aggregation</a></h2>
<p>Our solution leverages BLS aggregation, which is compatible with the <code>p2_delegated_puzzle_or_hidden_puzzle</code>, the most important smart contract in Chia. This approach combines the efficiency and security of BLS signatures with the robust infrastructure of Chia's ecosystem.</p>
<p>However, it is crucial to address potential vulnerabilities, especially the <strong>Rogue Public Key Attack</strong>. To mitigate such risks, users must generate their public keys independently to prevent potential forgery. The security of this scheme relies heavily on truly independent key generation processes and proper management of synthetic keys, which are critical for maintaining overall security.</p>
<h2 id="technical-definition-and-security-analysis"><a class="header" href="#technical-definition-and-security-analysis">Technical Definition and Security Analysis</a></h2>
<h3 id="mathematical-definition"><a class="header" href="#mathematical-definition">Mathematical Definition</a></h3>
<p>A multisig scheme using BLS aggregation consists of four main functions: <strong>generate</strong>, <strong>sign</strong>, <strong>aggregate</strong>, and <strong>verify</strong>.</p>
<h4 id="key-generation"><a class="header" href="#key-generation">Key Generation</a></h4>
<ol>
<li>Each participant generates a random private key: \( x_1, x_2 \in (0,r) \)</li>
<li>Public keys are derived: \( P_1 = g^{x_1}, P_2 = g^{x_2} \in \mathbb{G}_1 \)</li>
<li>Aggregated public key is calculated: \( P_a = g^{x_1} + g^{x_2} \in \mathbb{G}_1 \)</li>
<li>Synthetic private key is derived: \( x_s = H(P_a) \in \mathbb{F}_r \)</li>
<li>Synthetic public key is calculated: \( P_s = g^{x_s} + P_a \)</li>
</ol>
<h4 id="signing-process"><a class="header" href="#signing-process">Signing Process</a></h4>
<p>Given private keys \( x_1, x_2 \) and a message \( m \), the signature is computed by:</p>
<ol>
<li>Hash the message and synthetic public key: \( h = H(m, P_s) \)</li>
<li>Generate three signatures:
<ul>
<li>\( \sigma_s = h^{x_s} \in \mathbb{G}_2 \)</li>
<li>\( \sigma_1 = h^{x_1} \)</li>
<li>\( \sigma_2 = h^{x_2} \)</li>
</ul>
</li>
</ol>
<h4 id="signature-aggregation"><a class="header" href="#signature-aggregation">Signature Aggregation</a></h4>
<p>The signatures are aggregated as: \( \sigma = \sigma_s + \sigma_1 + \sigma_2 \)</p>
<h4 id="verification"><a class="header" href="#verification">Verification</a></h4>
<p>The signature \( \sigma \) is verified by checking: \( e(g, \sigma) = e(P_s, h) \)</p>
<blockquote>
<p>This can be expanded as:</p>
<p>\[ e(g, \sigma) = e(P_s, h) \]</p>
<p>\[ e(g, \sigma_s + \sigma_1 + \sigma_2) = e(g^{x_s} + g^{x_1} + g^{x_2}, h) \]</p>
<p>\[ e(g, h^{x_s+x_1+x_2}) = e(g^{x_s + x_1 + x_2}, h) \]</p>
<p>\[ e(g, h) = e(g, h) \]</p>
</blockquote>
<h3 id="security-analysis-and-considerations"><a class="header" href="#security-analysis-and-considerations">Security Analysis and Considerations</a></h3>
<h4 id="rogue-public-key-attack"><a class="header" href="#rogue-public-key-attack">Rogue Public Key Attack</a></h4>
<p>In this attack, an adversary could register a public key \( P_2 = g^{x'_2} - P_1 \in \mathbb{G}_1 \), where \( x'_2 \) is carefully chosen by the attacker. The synthetic public key would then be \( P_s = g^{x_s} + P_1 + P_2 = g^{x_s} + P_1 + g^{x'_2} - P_1 = g^{x_s} + g^{x'_2} \). The attacker could then forge an aggregate signature \( \sigma = \sigma_s + \sigma_2 \) that would pass verification.</p>
<h4 id="mitigation-strategies"><a class="header" href="#mitigation-strategies">Mitigation Strategies</a></h4>
<ol>
<li><strong>Independent Key Generation</strong>: Ensure that both parties generate their private keys independently.</li>
<li><strong>Commit-and-Open Approach</strong>: Both parties first provide a hash of their public key before revealing the actual public key.</li>
<li><strong>Proof of Possession</strong>: Require each participant to prove possession of their private key.</li>
</ol>
<h2 id="related-approaches"><a class="header" href="#related-approaches">Related Approaches</a></h2>
<h3 id="1-custody-tool"><a class="header" href="#1-custody-tool">1. Custody Tool</a></h3>
<p>The Custody Tool provided by Chia Network offers a comprehensive solution for managing digital assets but is considered too heavy and complex for our specific use case. It provides advanced features for institutional custody but introduces unnecessary complexity for our implementation.</p>
<p>Reference: <a href="https://docs.chia.net/custody-tool/">Chia Custody Tool Documentation</a></p>
<h3 id="2-bls-aggregation-for-threshold-signature"><a class="header" href="#2-bls-aggregation-for-threshold-signature">2. BLS Aggregation for Threshold Signature</a></h3>
<p>BLS threshold signatures allow for a flexible m-of-n signature scheme. In a \( m \)/\( n \) threshold signature scheme, \( m \) participants must contribute to create a valid signature.</p>
<p>The key generation process involves:</p>
<ol>
<li>Each participant generates their private key</li>
<li>Public keys are calculated individually</li>
<li>An aggregate public key is derived by combining individual public keys</li>
</ol>
<p>While this approach offers flexibility, the method currently lacks maturity and may not yet be fully reliable for all use cases.</p>
<p>References:</p>
<ul>
<li><a href="https://crypto.stanford.edu/%7Edabo/pubs/papers/BLSmultisig.html">BLS Multi-Signatures With Public-Key Aggregation</a></li>
<li><a href="https://muens.io/bls-signature-aggregation">BLS Signature Aggregation</a></li>
<li><a href="https://csrc.nist.gov/presentations/2023/mpts2023-day1-talk-threshold-BLS">Exploring the power of threshold BLS</a></li>
<li><a href="https://www.jcraige.com/threshold-bls-signatures">Threshold BLS Signatures</a></li>
<li><a href="https://geeklaunch.io/blog/understanding-elliptic-curves-pairings-bls-signatures/">Path to understanding: elliptic curves, pairings, and BLS signatures</a></li>
<li><a href="https://alinush.github.io/2020/03/12/scalable-bls-threshold-signatures.html">Fast and Scalable BLS Threshold Signatures</a></li>
</ul>
<h3 id="3-p2_m_of_n_delegate_direct"><a class="header" href="#3-p2_m_of_n_delegate_direct">3. p2_m_of_n_delegate_direct</a></h3>
<p>This approach provides a more generalized m-of-n multisignature scheme, allowing for flexible threshold requirements. It extends the functionality beyond the 2/2 case to support scenarios where only a subset of signers is required. However, it requires specific smart contract of coin, which is not compactible with the main-stream coins - <code>p2_delegated_puzzle_or_hidden_puzzle</code>.</p>
<p>Reference: <a href="https://github.com/Chia-Network/chia-blockchain/blob/main/chia/wallet/puzzles/p2_m_of_n_delegate_direct.clsp">Chia GitHub Repository</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="general-security-principles"><a class="header" href="#general-security-principles">General Security Principles</a></h1>
<h2 id="user-master-password"><a class="header" href="#user-master-password">User Master Password</a></h2>
<p>Used to decrypt local data containing the user data.</p>
<ul>
<li>Never stored in any server, nor any form of its derivatives.</li>
<li>Never stored locally until the user enables “Remember”.</li>
<li>Never transmitted over the internet.</li>
<li>Master Password verification is delayed by PBKDF2-SHA2 to mitigate brute force crack.</li>
</ul>
<h2 id="user-data"><a class="header" href="#user-data">User Data</a></h2>
<p>Contains sensitive information including mnemonics and private keys.</p>
<ul>
<li>Utilize AES 256 for encryption and decryption.</li>
<li>A salt for encryption is generated using a web crypto random function for each setup.</li>
<li>The user data is stored in the web browser's local storage. This local storage is in turn stored on the user file system with the browser profile data.</li>
</ul>
<h2 id="decrypted-data-usage"><a class="header" href="#decrypted-data-usage">Decrypted Data Usage</a></h2>
<ul>
<li>Private keys are saved in memory without having to ask the user for Master Password each time.</li>
<li>Private keys are sent from different instances through local storage or web sockets that utilize ECDH and AES.</li>
<li>Memory protection depends on the browser’s security.</li>
</ul>
<h2 id="communication"><a class="header" href="#communication">Communication</a></h2>
<ul>
<li>All communication between Pawket wallet and Pawket servers is secured with HTTPS.</li>
<li>Only insensitive information like spend-bundle, puzzle_hash, and coin_name can be sent to the server.</li>
<li>Users are allowed to host the server on-premise for better security.</li>
</ul>
<h2 id="air-gapped-signing"><a class="header" href="#air-gapped-signing">Air-gapped Signing</a></h2>
<p>Only save your mnemonic on an offline device and sign using a QR code exchange.</p>
<h2 id="shadow-wallet"><a class="header" href="#shadow-wallet">Shadow Wallet</a></h2>
<p>Fully compatible with BIP39, with shadow wallet support.</p>
<h2 id="super-light-wallet"><a class="header" href="#super-light-wallet">Super Light Wallet</a></h2>
<p>Utilize server performance superiority, and mitigate the burden of Light Wallet to handle dusted accounts smoothly.</p>
<h2 id="single-mnemonic-multiple-accounts"><a class="header" href="#single-mnemonic-multiple-accounts">Single Mnemonic Multiple Accounts</a></h2>
<p>With a single mnemonic, the user can create multiple accounts bootstrap with a sequence or shadow password.</p>
<h2 id="cross-platform"><a class="header" href="#cross-platform">Cross Platform</a></h2>
<p>Support multiple platforms and cross-platform experiences.</p>
<h2 id="dapp-integration"><a class="header" href="#dapp-integration">dApp Integration</a></h2>
<p>External API that allows other dApp to be easily integrated into the Chia Blockchain.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="risks-mitigation-strategies"><a class="header" href="#risks-mitigation-strategies">Risks Mitigation Strategies</a></h1>
<h2 id="offline-mode"><a class="header" href="#offline-mode">Offline mode</a></h2>
<p>The most important risk mitigation strategy is offline mode. Pawket can fully work in offline mode with degraded function. Only signing is allowed in this mode. The communication between offline devices and blockchain is through the QR code.</p>
<h2 id="fingerprint"><a class="header" href="#fingerprint">Fingerprint</a></h2>
<p>Mnemonics and Account fingerprints are fully compatible with Official Chia Wallet.</p>
<h2 id="malicious-spend-bundle-discovery"><a class="header" href="#malicious-spend-bundle-discovery">Malicious Spend Bundle Discovery</a></h2>
<p>When interacting with unfamous dApp, no reputation can be used to prove they are trustful to generate a safe spend bundle. With the coin analysis tool, Pawket can quickly find malicious coins or corrupted spend-bundle and give users a significant warning message.</p>
<h2 id="coinoffer-analysis"><a class="header" href="#coinoffer-analysis">Coin/Offer Analysis</a></h2>
<p>Power users are also allowed to analyze coin/offer thoroughly.</p>
<p>TODO: add analysis UI image</p>
<h2 id="phishing"><a class="header" href="#phishing">Phishing</a></h2>
<p>In this attack scenario, an attacker would create a page looking like a regular login page, or inject an additional javascript on a legitimate Pawket page.</p>
<p>Pawket mitigates this type of attack by using a &quot;reserved security token&quot;. After the user is unlocked with the right password, the user will be welcomed with this &quot;reserved security token&quot;. To prevent an attacker from placing a transparent input dialog on top of the input box, for example, to capture the passphrase, a field focus event displays an additional interaction in place with color changes.</p>
<h2 id="cross-site-scripting-xss"><a class="header" href="#cross-site-scripting-xss">Cross Site Scripting (XSS)</a></h2>
<p>High on the list of web application vulnerabilities, an XSS vulnerability would allow an attacker to run arbitrary content on the page.</p>
<h3 id="persistent-xss"><a class="header" href="#persistent-xss">Persistent XSS</a></h3>
<p>In this scenario, an attacker would submit malicious data to the server that would then be executed on the page when accessed by another user.</p>
<p>While Pawket server API would provide textual information and the Chialisp program. We assume it is the responsibility of the clients to treat the server information as hostile and take care of the sanitization.</p>
<p>In practice, in most cases, this means only rendering the information as text and using escaping facilities provided by the templating libraries used by Pawket (Vue) and template literals.</p>
<p>One common threat is the execution of the Chialisp program. First, the Chialisp program is designed to be a purely functional programming language, meaning no side effects exist so that no environment would be affected. Second, the Chialisp program would be executed in an iframe sandbox to avoid any possible affection.</p>
<p>Additionally, Pawket is preventing running inline javascript or including javascript files from third-party domains.</p>
<h3 id="reflected-xss"><a class="header" href="#reflected-xss">Reflected XSS</a></h3>
<p>In this scenario, an attacker would craft a link (for example in an email) to run arbitrary code when the user navigates on the Pawket domain.</p>
<p>In certain cases, Pawket uses parameters provided in URLs. URL parameters are used, for example, to directly launch a send transaction (which allows 3rd party dApp to launch Pawket for sending) or accept an offer.</p>
<p>The attack surface for reflected XSS is reduced by running validation on the requested content, for example, the address of send target would be decoded by bech32m first, and the Chialisp program executes in the iframe sandbox.</p>
<h3 id="unsafe-methods"><a class="header" href="#unsafe-methods">Unsafe methods</a></h3>
<p>The execution of javascript <code>eval</code> statements is not allowed.</p>
<h3 id="sql-injection"><a class="header" href="#sql-injection">SQL Injection</a></h3>
<p>The server-side application seldom uses direct SQL queries but instead accesses the data through the framework ORM. By default, these database abstraction layers prevent most SQL injection issues. User input used by the ORM is always carefully validated. The remaining risks are mitigated using code reviews.</p>
<h3 id="file-upload"><a class="header" href="#file-upload">File upload</a></h3>
<p>File upload is another sensitive area for web applications. Pawket at the moment only supports offer upload. The offer file size limit can be controlled by the administrator using the webserver environment variables.</p>
<h3 id="csrf"><a class="header" href="#csrf">CSRF</a></h3>
<p>Cross-Site Request Forgery is an attack scenario where a user's action on a malicious third-party site would trigger a modification of data on a website, such as editing a resource or deleting it, crafting a malicious image URL, or having the user submit a form from another domain.</p>
<p>The Pawket server is stateless and authenticate-less, so no one can launch such an attack on the Pawket server.</p>
<h3 id="recovery-risks"><a class="header" href="#recovery-risks">Recovery risks</a></h3>
<p>To recover an account a user must import their mnemonics and optional the accounts to regain access to their accounts. This process makes an attack scenario quite complicated but reduces the usability for the end user by introducing chances of losing access to the account permanently if the mnemonics are lost.</p>
<h3 id="source-control"><a class="header" href="#source-control">Source Control</a></h3>
<p>Pawket utilizes git for source control, and Azure DevOps for fully automated CI/CD. Both codes in client and server have an adequate level of coverage. Tests are forced during the continuous integration process.</p>
<p>For every release, digital signatures are published to help the end-user or enterprise administrator ensure the integrity of each release.</p>
<p>Only a small amount of people are responsible and allowed to publish code. Before being pushed on a sensitive branch, each pull request is therefore reviewed and validated by different maintainers.</p>
<h3 id="bug-bounty"><a class="header" href="#bug-bounty">Bug bounty</a></h3>
<p>When we have a sponsor, we will run a bug bounty program to further increase the security level.</p>
<!-- ### 3rd Party Audits -->
<div style="break-before: page; page-break-before: always;"></div><h1 id="impact-on-potential-attack-scenarios"><a class="header" href="#impact-on-potential-attack-scenarios">Impact on Potential Attack Scenarios</a></h1>
<h2 id="compromised-network"><a class="header" href="#compromised-network">Compromised Network</a></h2>
<h3 id="man-in-the-middle"><a class="header" href="#man-in-the-middle">Man in the middle</a></h3>
<p>If an attacker can break the TLS connection between the client and the server they will have access to the unencrypted data, and as such be able to capture the raw spend bundle for MEV or user-interested addresses for identity linking.</p>
<p>To reduce these risks a Pawket administrator must ensure that the server SSL configuration is configured to modern standards for example by disabling support for weak algorithms.</p>
<h2 id="compromised-client"><a class="header" href="#compromised-client">Compromised client</a></h2>
<h3 id="memory-access"><a class="header" href="#memory-access">Memory access</a></h3>
<p>Pawket does not protect the end user in a scenario where the attacker would be able to read the content of the memory on the client, e.g. a scenario where an attacker is capable of breaking the browser sandbox. Regular organizations should be fine by making sure the end user browsers are up to date and without malicious extensions installed.</p>
<h3 id="filesystem--keylogger-access"><a class="header" href="#filesystem--keylogger-access">Filesystem / keylogger access</a></h3>
<p>Similarly, Pawket does not fully protect the end-user in a scenario where the attacker has read access to the local filesystem or has a keylogger installed. It would be possible in this scenario for example to gather the secret key from the local storage and the passphrase using a keylogger. Enforcing general end user endpoint security best practices (such as having an anti-virus in place, patched operating system, etc.) should be enough to mitigate the remaining risks to an acceptable level for most organizations.</p>
<h3 id="clipboard-access"><a class="header" href="#clipboard-access">Clipboard access</a></h3>
<p>Similarly, Pawket cannot prevent another application or web extension with clipboard access right to listen to clipboard changes and protect the password if the user chooses to use this functionality in a compromised environment. Reducing the number of installed applications and extensions to a minimum is a good risk mitigation measure.</p>
<h3 id="input-method"><a class="header" href="#input-method">Input method</a></h3>
<p>Very similar to keylogger, but this is much more common than that scenario. When importing mnemonics, one could commonly input mnemonics with an input method, but this could leak these sensitive mnemonics through the input method provider, especially when the input method would collect the inputs to do some analysis later. Using the system input method without collecting could save you.</p>
<h3 id="weak-rng"><a class="header" href="#weak-rng">Weak RNG</a></h3>
<p>Pawket utilize browser built-in RNG (random number generator) for mnemonics generation (<code>crypto.getRandomValues()</code>). It's critical to have safe mnemonics by the safe RNG. Pawket does not protect the end user in a scenario where the attacker has changed the behavior of browser RNG.</p>
<h2 id="misconfigured-client"><a class="header" href="#misconfigured-client">Misconfigured client</a></h2>
<h3 id="weak-master-password"><a class="header" href="#weak-master-password">Weak master password</a></h3>
<p>At the moment there are no rules to enforce that a password must be strong even though it is encouraged. For example, it is possible for a user to setup a password with one digit.</p>
<h3 id="reserved-security-token"><a class="header" href="#reserved-security-token">Reserved Security Token</a></h3>
<p>Our research shows that the majority of users do not understand the concept of phishing and therefore do not understand the concepts behind the reserved security token. Additional training and prompts may be required for this mechanism to be useful.</p>
<h2 id="malicious-web-application"><a class="header" href="#malicious-web-application">Malicious Web Application</a></h2>
<h3 id="rogue-vendor-employee"><a class="header" href="#rogue-vendor-employee">Rogue vendor employee</a></h3>
<p>An attacker with access to the Pawket server or CDN would be able to distribute a malicious web application. To mitigate this risk, every developer of the Pawket team must use a strong password, only with the approval of maintainers, the code can be published. Moreover, notifications are sent to the maintainers and committee after a publication.</p>
<h2 id="malicious-dapp"><a class="header" href="#malicious-dapp">Malicious dApp</a></h2>
<h3 id="misleading-guide"><a class="header" href="#misleading-guide">Misleading Guide</a></h3>
<p>When a transaction is raised by dApp, it may intend to give the user misleading guidance, and inject misleading text (e.g. &quot;Official&quot;, &quot;Pawket&quot;). Pawket would give the user a visually distinguished area of dApp raised text.</p>
<h3 id="malicious-chialisp-program"><a class="header" href="#malicious-chialisp-program">Malicious Chialisp Program</a></h3>
<p>All code is executed in the sandbox, it's safe to get the execution result of the Chialisp program. However, the generated UTXO may have a flaw, e.g. the UTXO can be transferred by an unauthenticated malicious adversary. Pawket has a built-in mechanism to check some common issues of spend bundles, but not all issues can be found. Users are encouraged to use dApp with reputation and audit reports to avoid this type of attack.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="about-us"><a class="header" href="#about-us">About Us</a></h1>
<p>We are a group of experts in cryptocurrencies, analytics and engineering. Our main expertise lies in frontend, backend and blockchain development, as well as community building and customer service.</p>
<div style="break-before: page; page-break-before: always;"></div><p align="center" style="margin-top: 40vh; margin-left: calc(50vw - 150px - 15px); float: left;">
  <a href="https://info.pawket.app"><img src="https://info.pawket.app/images/site-navigation/logo.svg" alt="pawket" width="300" /></a>
</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="mermaid.min.js"></script>
        <script type="text/javascript" src="mermaid-init.js"></script>
        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
    </body>
</html>
